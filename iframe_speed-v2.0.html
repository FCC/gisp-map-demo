<!DOCTYPE html>
<!--
    __________________   __  ___                
   / ____/ ____/ ____/  /  |/  /___ _____  _____
  / /_  / /   / /      / /|_/ / __ `/ __ \/ ___/
 / __/ / /___/ /___   / /  / / /_/ / /_/ (__  ) 
/_/    \____/\____/  /_/  /_/\__,_/ .___/____/  
                                 /_/            
-->
<html class="no-js" lang="en">

<head>
    <title>FCC - Broadband Map Progress Report</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="FCC - Broadband Map Progress Report">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="img/fcc_favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/mapbox.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
	<link href="css/app1.css" rel="stylesheet">
	
</head>

<body style="margin: 0px;">

    <main class="container" style="width: 920px; margin: 0px">
        <div class="row" style="width: 920px;">
            <div class="col-md-12" style="width: 920px;">

                <div id="search-field" class="input-group" style="width: 920px">
                    <div class="search-group">
                        <div class="search-input">
                            <div class="input-group">
							
                                <div class="input-group-btn">
                                    <button aria-expanded="false" data-toggle="dropdown" class="btn btn-default dropdown-toggle" type="button"><span id="btn-label">Address</span> <span class="caret"></span></button>
                                    <ul id="input-search-switch" role="menu" class="dropdown-menu">
										<li><a href="#" data-value="loc">Address</a></li>
										<li><a href="#" data-value="latlon-decimal">Coordinates</a></li>

                                        
                                    </ul>
                                </div>
								
								<input id="input-location" class="form-control" type="search" placeholder="Enter Address" style="display: block">

								<div id="input-latlon-decimal" class="form-control" type="search" placeholder="Enter Latlon decimal" style="display: none">
								<table id="table-latlon-decimal"><tr>
								<td>Latitude: <input id="latitude"   placeholder="41.234567" style="width: 150px; height: 20px; border: solid 1px #eee"></td>
								<td width=75></td>
								<td>Longitude: <input id="longitude"   placeholder="-91.234567" style="width: 150px; height: 20px; border: solid 1px #eee"></td>

								</tr></table>
								</div>
								
                                <span class="input-group-btn" id="span-location-search" style="display: table-cell">                        
									<button class="btn-search btn btn-default" type="submit" id="input-loc-search" title="Location Search" data-toggle="tooltip" data-placement="top"><span class="glyphicon glyphicon-search"></span><span class="sr-only">Location Search</span></button>
                                </span>
								
                                <span class="input-group-btn" id="span-latlon-dms-search" style="display: none">                        
									<button class="btn-search btn btn-default" id="input-latlon-dms-search" title="DMS Latlon Search" data-toggle="tooltip" data-placement="top"><span class="glyphicon glyphicon-search"></span><span class="sr-only">DMS Lat/Lon Search</span></button>
                                </span>
								
								<span class="input-group-btn" id="span-latlon-decimal-search" style="display: none">                        
									<button class="btn-search btn btn-default" id="input-latlon-decimal-search" title="Decimal Latlon Search" data-toggle="tooltip" data-placement="top"><span class="glyphicon glyphicon-search"></span><span class="sr-only">Decimal Lat/Lon Search</span></button>
                                </span>
								
							</div>
                        </div>
                        <div class="btn-group-loc">
                            <span class="input-group-btn">  
								<button class="btn-geoLocation btn btn-default st" title="Get Current Location" data-toggle="tooltip" data-placement="top" id="btn-geoLocation" type="button" data-original-title="Get Current Location">
								<span class="fa fa-location-arrow"></span><span class="sr-only">Get Current Location</span></button>

							
							<button class="btn-nationLocation btn btn-default st" title="Nationwide" data-toggle="tooltip" data-placement="top" id="btn-nationLocation" type="button" data-original-title="Nationwide"><span class="icon-nation-1"></span><span class="sr-only">Nationwide</span></button>
                            </span>
                        </div>
                    </div>
                </div>
				
				</div>
			</div>
		</div>
		
		<div class="rowxx" style="width: 920px">
			<div id="map" style="width: 920px">
			
			<div id="div-legend" style="position: absolute; bottom: 10px; left: 10px; background-color: #FFFFFF; border: solid 1px #999999; z-index: 2; visibility: visible: none">
				<table style="margin: 5px">
				<tr><td colspan=3>
                 <span class="glyphicon glyphicon-th-list"></span> <span class="map-legend-name">Map Legend</span>
								<button class="btn-closeLegend btn btn-xs pull-right">
									<span class="glyphicon glyphicon-remove"></span> <span class="sr-only">Hide legend</span>
								</button>
				</td></tr>
				<tr><td><input type="checkbox" id="0" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #ffffcc; opacity: 1.0; border: solid 1px #999999"></div></td><td> No residential services at 200 kbps or above</td></tr>
				<tr><td><input type="checkbox" id="1" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #c7e9b4; opacity: 1.0; border: solid 1px #999999"></div></td><td> Residential services of at least 200 kbps</td></tr>
				<tr><td><input type="checkbox" id="2" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #7fcdbb; opacity: 1.0; border: solid 1px #999999"></div></td><td> Residential services of at least 10 Mbps/1 Mbps</td></tr>
				<tr><td><input type="checkbox" id="3" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #bdd7e7; opacity: 1.0; border: solid 1px #999999"></div></td><td> Residential Broadband of at least 25 Mbps/3 Mbps</td></tr>
				<tr><td><input type="checkbox" id="4" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #3182bd; opacity: 1.0; border: solid 1px #999999"></div></td><td> Residential Broadband of at least 50 Mbps/5 Mbps</td></tr>
				<tr><td><input type="checkbox" id="5" class="checkbox-provider" checked>&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #08306b; opacity: 1.0; border: solid 1px #999999"></div></td><td> Residential Broadband of at least 100 Mbps/5 Mbps</td></tr>
				<tr style="height: 1px; background-color: #cccccc"><td colspan=3></td></tr>
				<tr><td><input type="checkbox" id="6" class="checkbox-provider">&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #FFFFFF; background-image: url(img/slash.png); border: solid 1px #cccccc; opacity: 1.0"></div></td><td> Tribal land</td></tr>
				<tr><td><input type="checkbox" id="7" class="checkbox-provider">&nbsp;</td><td style="width: 28px; height: 28px;"><div style="width: 20px; height: 20px; background-color: #FFFFFF; background-image: url(img/dot.png); border: solid 1px #cccccc; opacity: 1.0"></div></td><td> Urban area</td></tr>

				</table>

			</div>
			<div id="div-legend-icon"  style="position: absolute; bottom: 10px; left: 10px;z-index: 1; cursor: pointer;" title="Map Legend">
			<span class="glyphicon glyphicon-th-list"></span>
			</div>
			
			</div>

		</div>


		
    </main>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="js/vendor/bootstrap.min.js"></script>
    <script src="js/vendor/jszip.min.js"></script>
    <script src="js/vendor/jszip-utils.js"></script>
    <script src="js/vendor/FileSaver.min.js"></script>
	<script src="js/vendor/Blob.js"></script>
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
	<script src="//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-pip/v0.1.0/leaflet-pip.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	
    <script>
	
	var map;
	var layerList;
	var layer0;
	var layer1;
	var layer2;
	var layer3;
	var layer4;
	var layer5;
	var bpr_county_layer_urban;
	var bpr_tribal;

	
	var geo_host = "http://ldevtm-geo02:8080";
	var geo_host = "http://www.broadbandmap.gov";
	var geo_space = "fcc";
	
	
	function createMap() {
 
     L.mapbox.accessToken = 'pk.eyJ1IjoiY29tcHV0ZWNoIiwiYSI6InMyblMya3cifQ.P8yppesHki5qMyxTc2CNLg';
     map = L.mapbox.map('map', 'fcc.k74ed5ge', {
             attributionControl: true,
             maxZoom: 15,
			 minZoom: 3
         })
         .setView([50, -105], 3);
		 
	 baseStreet = L.mapbox.tileLayer('fcc.k74ed5ge').addTo(map);
     baseSatellite = L.mapbox.tileLayer('fcc.k74d7n0g');
     baseTerrain = L.mapbox.tileLayer('fcc.k74cm3ol');
	 
	 layer0 = L.mapbox.tileLayer('fcc.a6335c39').setZIndex(11).addTo(map);
	 layer1 = L.mapbox.tileLayer('fcc.0376ced1').setZIndex(12).addTo(map);
	 layer2 = L.mapbox.tileLayer('fcc.4272cf6a').setZIndex(13).addTo(map);
	 layer3 = L.mapbox.tileLayer('fcc.438e9976').setZIndex(14).addTo(map);
	 layer4 = L.mapbox.tileLayer('fcc.fffd995f').setZIndex(15).addTo(map);
	 layer5 = L.mapbox.tileLayer('fcc.91a6e516').setZIndex(16).addTo(map);
	 
	bpr_county_layer_urban = L.tileLayer.wms(geo_host + '/geoserver/wms', {
		format: 'image/png',
		transparent: true,
		layers: geo_space + ':bpr_county_layer_urban_only',
		styles: 'bpr_layer_urban'
	}).setZIndex(21);
	
	bpr_tribal = L.tileLayer.wms(geo_host + '/geoserver/wms', {
		format: 'image/png',
		transparent: true,
		layers: geo_space + ':bpr_tribal',
		styles: 'bpr_tribal'
	}).setZIndex(22);
	
	layerList = [layer0, layer1, layer2, layer3, layer4, layer5, bpr_tribal, bpr_county_layer_urban];
	 
	layerControl = new L.Control.Layers({
         'Street': baseStreet.addTo(map),
         'Satellite': baseSatellite,
         'Terrain': baseTerrain
     }, {

     }, {
		position: 'topleft'
	 }
	 ).addTo(map);
		 
	 L.control.scale({
         position: 'bottomright'
     }).addTo(map);

     geocoder = L.mapbox.geocoder('mapbox.places-v1');

	}
	
	function activateAllLegends() {
	for (var i = 0; i < 10; i++) {
	if (i <= 5) {
		$('#' + i).prop('checked', true);
	}
	else {
		$('#' + i).prop('checked', false);
	}
	}
	}
	
	
	function searchLocation() {
		locChange();
	}
	
	function locChange() {
	var loc = $("#input-location").val();
	geocoder.query(loc, codeMap);
	
	function codeMap(err, data) {

	if (data.results.features.length == 0) {
		alert("No results found");
		return;
	}
	var lat = data.latlng[0];
	var lon = data.latlng[1];
	
	map.setView([lat, lon], 14);

	}
	}
	
	function search_dms() {

	var lat_deg = $('#lat-deg').val();
	var lat_min = $('#lat-min').val();
	var lat_sec = $('#lat-sec').val();
	var ns = $('#select-ns').val();
	var lon_deg = $('#lon-deg').val();
	var lon_min = $('#lon-min').val();
	var lon_sec = $('#lon-sec').val();
	var ew = $('#select-ew').val();
	if (lat_deg == "" || lon_deg == "") {
	alert("empty fields");
	return;
	}

	lat_deg = Math.floor(lat_deg);
	lat_min = Math.floor(lat_min);
	if (lat_sec == "") {
		lat_sec = 0;
	}
	lat_sec = parseFloat(lat_sec);
	var lat = lat_deg + lat_min/60.0 + lat_sec/3600.0;
	lat = Math.round(lat*1000000) / 1000000.0;

	if (ns == "S") {
		lat = -1 * lat;
	}

	lon_deg = Math.floor(lon_deg);
	lon_min = Math.floor(lon_min);
	if (lon_sec == "") {
		lon_sec = 0;
	}
	lon_sec = parseFloat(lon_sec);
	var lon = lon_deg + lon_min/60.0 + lon_sec/3600.0;
	lon = Math.round(lon*1000000)/1000000.0;

	if (ew == "W") {
		lon = -1 * lon;
	}

	if (Math.abs(lat) > 90 || Math.abs(lon) > 180) {
		alert("Lat/Lon values out of range");
		return;
	}

	map.setView([lat, lon], 14);
	}
		

	function search_decimal() {

	var lat = $('#latitude').val().replace(/ +/g, "");
	var lon = $('#longitude').val().replace(/ +/g, "");

	if (lat == "" || lon == "") {
	alert("Please enter lat/lon");
	return;
	}

	if (Math.abs(lat) > 90 || Math.abs(lon) > 180) {
		alert("Lat/Lon values out of range");
		return;
	}

	map.setView([lat, lon], 14);

	} 
	
	
	
	
	function setupListener() {
		$('.checkbox-provider').on("click", function(e) {
			var id = e.target.id;
			var i = parseInt(id);

			if($('#' + id).prop('checked')) {
			//remove layer
			if (map.hasLayer(layerList[i])) {
			map.removeLayer(layerList[i]);
			}
			//add layer
			layerList[i].addTo(map);
			}
			else {
			//remove layer
			if (map.hasLayer(layerList[i])) {
			map.removeLayer(layerList[i]);
			}
			}
		});
		
		$('.btn-closeLegend').on("click", function(e) {
			$//hide legend
			$('#div-legend').css("visibility", "hidden");
		});
		
		$('#div-legend-icon').on("click", function(e) {
		$//show legend
		$('#div-legend').css("visibility", "visible");
		
		});
		
		
		$("#input-loc-search").on("click", function(e) {
         e.preventDefault();
         locChange();
     });

	 $("#input-latlon-dms-search").on("click", function(e) {
         e.preventDefault();
         search_dms();
     });
	 
	 $("#input-latlon-decimal-search").on("click", function(e) {
         e.preventDefault();
         search_decimal();
     });
	 
	$("#input-search-switch").on('click', 'a', function(e) {
		var search = $(e.currentTarget).data('value');
		
		e.preventDefault();	

		if (search == 'loc') {
			$("#input-latlon-dms").css('display', 'none');
			$("#span-latlon-dms-search").css('display', 'none');
			$("#input-latlon-decimal").css('display', 'none');
			$("#span-latlon-decimal-search").css('display', 'none');

			$("#input-location").css('display', 'block');
			$("#span-location-search").css('display', 'table-cell');
			$("#btn-label").text('Address');
        }
		
        else if (search == 'latlon-dms') {
		    $("#input-location").css('display', 'none');
            $("#span-location-search").css('display', 'none');
			$("#input-latlon-decimal").css('display', 'none');
			$("#span-latlon-decimal-search").css('display', 'none');
		
            $("#input-latlon-dms").css('display', 'block');
            $("#span-latlon-dms-search").css('display', 'table-cell');
			$("#btn-label").text('Lat/lon (DMS)');
        }
		
		
        else if (search == 'latlon-decimal') {
		    $("#input-location").css('display', 'none');
            $("#span-location-search").css('display', 'none');
			$("#input-latlon-dms").css('display', 'none');
			$("#span-latlon-dms-search").css('display', 'none');
			
            $("#input-latlon-decimal").css('display', 'block');
            $("#span-latlon-decimal-search").css('display', 'table-cell');
			$("#btn-label").text('Coordinates');
        }
	
	});
	
	$('#input-location').keypress(function (e) {
	 var key = e.which;
	 if(key == 13)  // the enter key code
	  {
	    $('#input-loc-search').click();
	    return false;  
	  }
	}); 
	
	
	$('#lat-deg, #lon-deg, #lat-min, #lon-min, #lat-sec, #lon-sec, #select-ns, #select-ew').keypress(function (e) {
	 var key = e.which;
	 if(key == 13)  // the enter key code
	  {
	    $('#input-latlon-dms-search').click();
	    return false;  
	  }
	});
	
		
	$('#latitude, #longitude').keypress(function (e) {
	 var key = e.which;
	 if(key == 13)  // the enter key code
	  {
	    $('#input-latlon-decimal-search').click();
	    return false;  
	  }
	});
	
     $('#btn-geoLocation').click(function(event) {
         if (navigator.geolocation) {
             navigator.geolocation.getCurrentPosition(function(position) {
                 var geo_lat = position.coords.latitude;
                 var geo_lon = position.coords.longitude;
                 var geo_acc = position.coords.accuracy;
				 
				 geo_lat = Math.round(geo_lat * 1000000) / 1000000.0;
				 geo_lon = Math.round(geo_lon * 1000000) / 1000000.0;

				map.setView([geo_lat, geo_lon], 14);

             }, function(error) {
                 //alert('Error occurred. Error code: ' + error.code);			 
                 alert('Sorry, your current location could not be found. \nPlease use the search box to enter your location.');
             }, {
                 timeout: 4000
             });
         } else {
             alert('Sorry, your current location could not be found. \nPlease use the search box to enter your location.');
         }

         return false;
     });

	$("#btn-nationLocation").on("click", function() {
         //map.fitBounds(bounds_us);
		 map.setView([50, -105], 3);
     });
	

	$( "#input-location" ).autocomplete({
        source: function( request, response ) {
			var location = request.term;
			geocoder.query(location, processAddress);
			
			function processAddress(err, data) {
			
			var f = data.results.features;
			var addresses = [];
			for (var i = 0; i < f.length; i++) {
				addresses.push(f[i].place_name);
			}
			response(addresses);

			}
        },
        minLength: 3,
        select: function( event, ui ) {
            setTimeout(function() {searchLocation();}, 200);
        },
        open: function() {
			$( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
        },
        close: function() {
			$( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
        }
	});
		
		
		
		
		
		
		
	
	}
	
	
	$(document).ready(function() {
		createMap();
		setupListener();
		activateAllLegends();
	});


    </script>


<img id="ajax-loader" src="img/ajax-loader.gif" style="position: absolute; top: -200px; left: -300px">
<div id="cursor-tip" style="position: absolute; top: -200px; left: -300px"></div>


</body>

</html>
